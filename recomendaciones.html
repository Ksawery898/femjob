<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FemJob | Recomendaciones</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="topbar">
  <div class="nav">
    <a class="brand" href="index.html" aria-label="FemJob - Ir a inicio">
      <div class="logo" aria-hidden="true"></div>
      <span>FemJob</span>
    </a>

    <nav class="navlinks" aria-label="Navegación principal">
      <a href="index.html">Inicio</a>
      <a class="active" href="recomendaciones.html">Recomendaciones</a>
      <a href="perfil.html">Mi Perfil</a>
      <a href="capacitacion.html">Capacitación</a>
      <a href="empresa.html">Empresas</a>
      <a href="sobre.html">Sobre</a>
      <a href="contacto.html">Contacto</a>
      <a href="faq.html">FAQ</a>
      <a href="terminos.html">Términos</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <span class="badge">Motor de recomendación (demo)</span>
    <h1>Recomendaciones personalizadas</h1>
    <p>
      Explora vacantes recomendadas. Puedes arrastrar la tarjeta (móvil/PC) o usar botones.
      Si activaste el <b>Modo cuidadora</b>, podrás filtrar ofertas compatibles con cuidados.
    </p>

    <div id="careBanner" class="care-chip" style="display:none;">Modo cuidadora activo</div>
  </section>

  <div class="grid">

    <aside class="card">
      <h2>Filtros rápidos</h2>

      <div class="field">
        <label>Área</label>
        <select id="fArea">
          <option>Marketing</option>
          <option>TI / Datos</option>
          <option>RR.HH.</option>
          <option>Administración</option>
          <option>Servicios</option>
        </select>
      </div>

      <div class="field">
        <label>Modalidad</label>
        <select id="fMod">
          <option>Híbrido</option>
          <option>Remoto</option>
          <option>Presencial</option>
        </select>
      </div>

      <div class="field">
        <label>Experiencia</label>
        <select id="fExp">
          <option>Junior</option>
          <option>Semi-senior</option>
          <option>Senior</option>
        </select>
      </div>

      <hr>

      <div class="field" style="margin-bottom:0;">
        <label style="display:flex; gap:10px; align-items:center;">
          <input id="careOnly" type="checkbox" />
          Mostrar solo empleos compatibles con cuidados
        </label>
      </div>

      <p class="hint" style="margin-top:8px;">
        *Este filtro está pensado para usuarias cuidadoras (madres/cuidadoras). En el prototipo, se basa en etiquetas de compatibilidad.
      </p>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <button class="btn secondary" type="button" onclick="applyFilters()">Aplicar</button>
        <button class="btn" type="button" onclick="location.href='perfil.html'">Editar perfil</button>
      </div>
    </aside>

    <section class="card">
      <h2>Tarjetas recomendadas</h2>
      <p class="meta" style="margin-bottom:10px;">Derecha = Guardar ✅ · Izquierda = Descartar ❌</p>

      <div class="swipe-wrap" id="swipeWrap" aria-label="Tarjetas de empleos recomendados">

        <!-- Compatible con cuidados -->
        <div class="swipe-card" data-compatible="true" data-id="1">
          <div class="care-badge">Compatible con cuidados</div>
          <h2 style="margin:0 0 6px;">Analista de Marketing (Part-time)</h2>
          <div class="meta">Empresa Naranja • Santiago • Remoto</div>
          <div class="tags">
            <span class="tag">Remoto</span>
            <span class="tag">Horario flexible</span>
            <span class="tag">Part-time</span>
          </div>
          <hr>
          <p><b>Resumen:</b> apoyo en campañas, métricas y reportes. Jornada reducida y flexible.</p>
          <span class="pill">90% compatibilidad</span>
        </div>

        <!-- NO compatible (para demostrar filtro) -->
        <div class="swipe-card" data-compatible="false" data-id="2">
          <h2 style="margin:0 0 6px;">Asistente de Bodega</h2>
          <div class="meta">Empresa X • Santiago • Presencial</div>
          <div class="tags">
            <span class="tag">Presencial</span>
            <span class="tag">Turnos</span>
            <span class="tag">Físico</span>
          </div>
          <hr>
          <p><b>Resumen:</b> apoyo operativo y logística. Requiere presencia completa y turnos.</p>
          <span class="pill">72% compatibilidad</span>
        </div>

        <!-- Compatible con cuidados -->
        <div class="swipe-card" data-compatible="true" data-id="3">
          <div class="care-badge">Compatible con cuidados</div>
          <h2 style="margin:0 0 6px;">Soporte Administrativo (Híbrido)</h2>
          <div class="meta">Empresa Z • Santiago • Híbrido</div>
          <div class="tags">
            <span class="tag">Híbrido</span>
            <span class="tag">Horario definido</span>
            <span class="tag">Beneficios familiares</span>
          </div>
          <hr>
          <p><b>Resumen:</b> apoyo administrativo, documentación y coordinación. Modalidad híbrida.</p>
          <span class="pill">84% compatibilidad</span>
        </div>

      </div>

      <div class="swipe-actions">
        <button class="btn bad" type="button" onclick="swipe('left')">Descartar</button>
        <button class="btn ok" type="button" onclick="swipe('right')">Guardar</button>
        <button class="btn primary" type="button" onclick="alert('Postulación simulada')">Postular</button>
      </div>

      <p class="hint" style="margin-top:12px;">
        *En este prototipo, “guardar” y “descartar” solo simulan la interacción. (Opcional: se puede guardar en localStorage si lo quieres).
      </p>
    </section>

  </div>

  <div class="footer">FemJob • Recomendaciones (demo)</div>
</main>

<script>
  const KEY_PROFILE = "femjob_profile_v1";
  const KEY_CARE = "femjob_care_mode_v1";

  // ===== Botones: animación + rotación de tarjetas =====
  function swipe(direction){
    const wrap = document.getElementById('swipeWrap');
    const card = wrap.querySelector('.swipe-card');
    if(!card) return;

    // Si filtro careOnly está activo, no dejes “guardar/descartar” una no-compatible sin aviso
    const careOnly = document.getElementById("careOnly").checked;
    const isCompatible = card.dataset.compatible === "true";

    if(careOnly && !isCompatible){
      // manda al fondo sin swipe completo para “saltar” no compatibles
      wrap.appendChild(card);
      ensureTopMatches();
      attachDragToTopCard();
      return;
    }

    card.classList.add(direction === 'left' ? 'is-left' : 'is-right');

    setTimeout(() => {
      card.classList.remove('is-left', 'is-right');
      card.style.transform = '';
      wrap.appendChild(card);
      ensureTopMatches();
      attachDragToTopCard();
    }, 260);
  }

  // ===== Swipe real: touch + mouse =====
  const THRESHOLD = 90;

  function attachDragToTopCard(){
    const wrap = document.getElementById('swipeWrap');
    const top = wrap.querySelector('.swipe-card');
    if(!top) return;

    if(top.dataset.dragReady === '1') return;
    top.dataset.dragReady = '1';

    let startX = 0, startY = 0;
    let dx = 0, dy = 0;
    let dragging = false;

    function onStart(clientX, clientY){
      dragging = true;
      startX = clientX;
      startY = clientY;
      dx = 0; dy = 0;
      top.style.transition = 'none';
    }

    function onMove(clientX, clientY){
      if(!dragging) return;
      dx = clientX - startX;
      dy = clientY - startY;

      const rot = Math.max(-10, Math.min(10, dx / 12));
      top.style.transform = `translate(${dx}px, ${dy * 0.25}px) rotate(${rot}deg)`;
    }

    function onEnd(){
      if(!dragging) return;
      dragging = false;

      top.style.transition = 'transform .22s ease, opacity .22s ease';

      const careOnly = document.getElementById("careOnly").checked;
      const isCompatible = top.dataset.compatible === "true";

      if(dx > THRESHOLD){
        // derecha = guardar
        if(careOnly && !isCompatible){
          top.style.transform = '';
          return;
        }
        top.classList.add('is-right');
        setTimeout(() => {
          top.classList.remove('is-right');
          top.style.transform = '';
          wrap.appendChild(top);
          ensureTopMatches();
          attachDragToTopCard();
        }, 240);

      } else if(dx < -THRESHOLD){
        // izquierda = descartar
        if(careOnly && !isCompatible){
          top.style.transform = '';
          return;
        }
        top.classList.add('is-left');
        setTimeout(() => {
          top.classList.remove('is-left');
          top.style.transform = '';
          wrap.appendChild(top);
          ensureTopMatches();
          attachDragToTopCard();
        }, 240);

      } else {
        top.style.transform = '';
      }
    }

    // Touch
    top.addEventListener('touchstart', (e) => {
      const t = e.touches[0];
      onStart(t.clientX, t.clientY);
    }, { passive: true });

    top.addEventListener('touchmove', (e) => {
      const t = e.touches[0];
      onMove(t.clientX, t.clientY);
    }, { passive: true });

    top.addEventListener('touchend', () => onEnd(), { passive: true });

    // Mouse
    top.addEventListener('mousedown', (e) => {
      onStart(e.clientX, e.clientY);

      const mm = (ev) => onMove(ev.clientX, ev.clientY);
      const mu = () => {
        document.removeEventListener('mousemove', mm);
        document.removeEventListener('mouseup', mu);
        onEnd();
      };

      document.addEventListener('mousemove', mm);
      document.addEventListener('mouseup', mu);
    });
  }

  // Si careOnly está activo, asegura que la tarjeta superior sea compatible
  function ensureTopMatches(){
    const wrap = document.getElementById('swipeWrap');
    const careOnly = document.getElementById("careOnly").checked;
    if(!careOnly) return;

    const cards = Array.from(wrap.querySelectorAll('.swipe-card'));
    if(cards.length === 0) return;

    // intenta rotar hasta encontrar una compatible (máx N intentos)
    let tries = cards.length;
    while(tries-- > 0){
      const top = wrap.querySelector('.swipe-card');
      if(!top) break;
      const ok = top.dataset.compatible === "true";
      if(ok) break;
      wrap.appendChild(top);
    }
  }

  function applyFilters(){
    // MVP: no filtra “de verdad” por área/mod/exp, solo simula
    ensureTopMatches();
    attachDragToTopCard();
    alert("Filtros aplicados (demo).");
  }

  function loadUserPrefs(){
    const care = localStorage.getItem(KEY_CARE) === "true";
    const banner = document.getElementById("careBanner");
    banner.style.display = care ? "inline-flex" : "none";

    // Por defecto: si modo cuidadora está ON, activar filtro de compatibilidad
    const careOnly = document.getElementById("careOnly");
    careOnly.checked = care;

    // Cargar perfil para setear selects (opcional)
    const raw = localStorage.getItem(KEY_PROFILE);
    const data = raw ? JSON.parse(raw) : {};
    document.getElementById("fArea").value = data.area || "Marketing";
    document.getElementById("fMod").value = data.modalidad || "Híbrido";
    document.getElementById("fExp").value = data.experiencia || "Junior";

    ensureTopMatches();
  }

  document.getElementById("careOnly").addEventListener("change", () => {
    ensureTopMatches();
    attachDragToTopCard();
  });

  window.addEventListener('load', () => {
    loadUserPrefs();
    attachDragToTopCard();
  });
</script>

</body>
</html>
